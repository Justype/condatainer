#%Module1.0
# Author: Ziyue Cheng
# Environment modulefile for reference data
# Almost all of them are automated, you can modify whatis, ModulesHelp as needed.

# absolute path of module, /somewhere/modules/ref-modules/assembly/data-type/version
set abs_path [file normalize [info script]]
# full name of module, assembly/data-type/version
set ref_full_name [module-info name]
set depth [expr {[llength [split $ref_full_name "/"]] + 1}]
# /somewhere/modules, go up 'depth' times from abs_path
set module_root $abs_path
for {set i 0} {$i < $depth} {incr i} {
    set module_root [file dirname $module_root]
}

set ref_root [file join $module_root ref $ref_full_name]
#  Make this script compatible with app modulefiles
set app_root $ref_root
set current_datetime [clock format [clock seconds] -format "%Y-%m-%d %H:%M:%S"]

module-whatis "{WHATIS}"
proc ModulesHelp {} {
    global $ref_full_name
    puts stderr "{HELP}"
}

# if {[module-info mode] == "load"} {
#     puts stderr "\[$current_datetime\] Loading module $ref_full_name"
# # } elseif { [module-info mode] == "unload" } {
# }

# Construct ENV VAR name
# Convert - → _, / → _, uppercase
set env_var_name [string toupper [string map { - _ . _ / _ } $ref_full_name]]
set env_var_name "${env_var_name}_HOME"

# Set environment variable
setenv $env_var_name $ref_root
