#WHATIS:rstudio-server container
Bootstrap: docker
From: ubuntu:24.04

%labels
    Author Ziyue Cheng
    Version 1.0
    Description "Ubuntu24-based container with RStudio Server"

%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8
    export PS1='CNT \w> '

%runscript
    exec /bin/bash "$@"	

%post
    # Avoid interactive prompts
    export DEBIAN_FRONTEND=noninteractive

    apt -y update && apt -y install \
        wget libssl-dev libclang-dev psmisc \
        libsqlite3-0 lsb-release sudo

    # RStudio Server
    case "$(uname -m)" in
        x86_64) url="https://download2.rstudio.org/server/jammy/amd64/rstudio-server-2025.09.2-418-amd64.deb" ;;
        aarch64) url="https://s3.amazonaws.com/rstudio-ide-build/server/jammy/arm64/rstudio-server-2026.01.0-388-arm64.deb" ;;
        *) echo "ERROR: Unsupported architecture: $(uname -m)"; exit 1 ;;
    esac
    wget -nv -O rstudio.deb $url
    dpkg -i rstudio.deb && rm rstudio.deb

    apt clean
